<?php
namespace App\Library\Pay\Yeke; use App\Library\Pay\ApiInterface; class Api implements ApiInterface { private $url_notify = ''; private $url_return = ''; public function __construct($spcbbf66) { $this->url_notify = SYS_URL_API . '/pay/notify/' . $spcbbf66; $this->url_return = SYS_URL . '/pay/return/' . $spcbbf66; } function goPay($spc6bf93, $sp30c318, $spc3fe8b, $sp66faf9, $spb959ec) { $sp7ca622 = sprintf('%.2f', $spb959ec / 100); define('yeke_USER_ID', $spc6bf93['id']); define('yeke_USER_KEY', $spc6bf93['key']); define('yeke_USER_LOG_PREFIX', 'log'); define('yeke_API_GATE', 'http://www.yekepay.com/api/ApiGo.php'); $sp08876a = strtolower($spc6bf93['payway']); $sp1df659 = ''; $sp60c1bc = ''; if ($sp08876a == 'alipay' || $sp08876a == 'alipay_wap') { $sp1df659 = 'alipay'; $sp60c1bc = 'ALIPAY'; } elseif ($sp08876a == 'tenpay' || $sp08876a == 'tenpay_wap') { $sp1df659 = 'tenpay'; $sp60c1bc = 'TENPAY'; } elseif ($sp08876a == 'weixin') { $sp1df659 = 'weixin'; $sp60c1bc = 'WEIXIN'; } elseif ($sp08876a == 'weixin_wap') { $sp1df659 = 'wxwap'; $sp60c1bc = 'wxwap'; } elseif ($sp08876a == 'qq' || $sp08876a == 'qq_wap') { $sp1df659 = 'sqzf'; $sp60c1bc = 'sqzf'; } elseif ($sp08876a == 'qq_wap') { $sp1df659 = 'sqzfqb'; $sp60c1bc = 'sqzfqb'; } require 'yekeApiLib.php'; require 'HttpClient.php'; $spc3fe8b = mb_substr($spc3fe8b, 0, 50, 'UTF-8'); $sp66faf9 = mb_substr($sp66faf9, 0, 100, 'UTF-8'); $sp342eea = array('P_orderid' => $sp30c318, 'P_paymoney' => $sp7ca622, 'P_productname' => urlencode($spc3fe8b), 'P_productinfo' => urlencode($sp66faf9), 'P_remark' => urlencode($sp30c318), 'P_custom_1' => urlencode($sp60c1bc), 'P_custom_2' => '', 'P_contact' => urlencode(SYS_NAME), 'P_paytype' => $sp1df659, 'P_gateway' => $sp60c1bc, 'P_cardnum' => '', 'P_cardpwd' => '', 'P_cardvalue' => '', 'P_notify_url' => $this->url_notify, 'P_return_url' => $this->url_return . '/' . $sp30c318); $spebda6f = new \yekeAPI(); $spe62cd8 = $spebda6f->payGate($sp342eea); echo $spe62cd8; } function verify($spc6bf93, $spc5d9aa) { $sp4dcba6 = isset($spc6bf93['isNotify']) && $spc6bf93['isNotify']; define('yeke_USER_ID', $spc6bf93['id']); define('yeke_USER_KEY', $spc6bf93['key']); define('yeke_USER_LOG_PREFIX', 'log'); define('yeke_API_GATE', 'http://www.yekepay.com/api/ApiGo.php'); require 'HttpClient.php'; require 'yekeApiLib.php'; $spebda6f = new \yekeAPI(); if ($sp4dcba6) { $spe62cd8 = $spebda6f->verifyNotify(); } else { $spe62cd8 = $spebda6f->verifyReturn(); } if ($spe62cd8) { $specd394 = $_REQUEST['P_orderid']; $sp30fa05 = $_REQUEST['P_api_orderid']; $sp859e51 = $_REQUEST['P_money']; if ($_REQUEST['P_status'] == 'SUCCESS') { $spc5d9aa($sp30fa05, (int) ($sp859e51 * 100), $specd394); if ($sp4dcba6) { echo 'success'; } return true; } else { if ($sp4dcba6) { echo '失败订单'; } } } else { if ($sp4dcba6) { echo '验证失败'; } } return false; } }