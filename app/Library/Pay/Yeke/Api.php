<?php
namespace App\Library\Pay\Yeke; use App\Library\Pay\ApiInterface; class Api implements ApiInterface { private $url_notify = ''; private $url_return = ''; public function __construct($sp5d3f49) { $this->url_notify = SYS_URL_API . '/pay/notify/' . $sp5d3f49; $this->url_return = SYS_URL . '/pay/return/' . $sp5d3f49; } function goPay($spc8c9ef, $sp4510be, $sp930bb6, $sp9a31c1, $spfa6477) { $sp7918ab = sprintf('%.2f', $spfa6477 / 100); define('yeke_USER_ID', $spc8c9ef['id']); define('yeke_USER_KEY', $spc8c9ef['key']); define('yeke_USER_LOG_PREFIX', 'log'); define('yeke_API_GATE', 'http://www.yekepay.com/api/ApiGo.php'); $spdae190 = strtolower($spc8c9ef['payway']); $sp956c08 = ''; $sp135ced = ''; if ($spdae190 == 'alipay' || $spdae190 == 'alipay_wap') { $sp956c08 = 'alipay'; $sp135ced = 'ALIPAY'; } elseif ($spdae190 == 'tenpay' || $spdae190 == 'tenpay_wap') { $sp956c08 = 'tenpay'; $sp135ced = 'TENPAY'; } elseif ($spdae190 == 'weixin') { $sp956c08 = 'weixin'; $sp135ced = 'WEIXIN'; } elseif ($spdae190 == 'weixin_wap') { $sp956c08 = 'wxwap'; $sp135ced = 'wxwap'; } elseif ($spdae190 == 'qq' || $spdae190 == 'qq_wap') { $sp956c08 = 'sqzf'; $sp135ced = 'sqzf'; } elseif ($spdae190 == 'qq_wap') { $sp956c08 = 'sqzfqb'; $sp135ced = 'sqzfqb'; } require 'yekeApiLib.php'; require 'HttpClient.php'; $sp930bb6 = mb_substr($sp930bb6, 0, 50, 'UTF-8'); $sp9a31c1 = mb_substr($sp9a31c1, 0, 100, 'UTF-8'); $sp7c7a93 = array('P_orderid' => $sp4510be, 'P_paymoney' => $sp7918ab, 'P_productname' => urlencode($sp930bb6), 'P_productinfo' => urlencode($sp9a31c1), 'P_remark' => urlencode($sp4510be), 'P_custom_1' => urlencode($sp135ced), 'P_custom_2' => '', 'P_contact' => urlencode(SYS_NAME), 'P_paytype' => $sp956c08, 'P_gateway' => $sp135ced, 'P_cardnum' => '', 'P_cardpwd' => '', 'P_cardvalue' => '', 'P_notify_url' => $this->url_notify, 'P_return_url' => $this->url_return . '/' . $sp4510be); $spe12a74 = new \yekeAPI(); $sp820aff = $spe12a74->payGate($sp7c7a93); echo $sp820aff; } function verify($spc8c9ef, $sp53cf01) { $sp412d81 = isset($spc8c9ef['isNotify']) && $spc8c9ef['isNotify']; define('yeke_USER_ID', $spc8c9ef['id']); define('yeke_USER_KEY', $spc8c9ef['key']); define('yeke_USER_LOG_PREFIX', 'log'); define('yeke_API_GATE', 'http://www.yekepay.com/api/ApiGo.php'); require 'HttpClient.php'; require 'yekeApiLib.php'; $spe12a74 = new \yekeAPI(); if ($sp412d81) { $sp820aff = $spe12a74->verifyNotify(); } else { $sp820aff = $spe12a74->verifyReturn(); } if ($sp820aff) { $spc9ab13 = $_REQUEST['P_orderid']; $spb9c2e7 = $_REQUEST['P_api_orderid']; $sp102958 = $_REQUEST['P_money']; if ($_REQUEST['P_status'] == 'SUCCESS') { $sp53cf01($spb9c2e7, (int) round($sp102958 * 100), $spc9ab13); if ($sp412d81) { echo 'success'; } return true; } else { if ($sp412d81) { echo '失败订单'; } } } else { if ($sp412d81) { echo '验证失败'; } } return false; } }