<?php
ini_set('date.timezone', 'Asia/Shanghai'); error_reporting(E_ERROR); require_once '../lib/WxPay.Api.php'; require_once '../lib/WxPay.Notify.php'; require_once '../WxLog.php'; class PayNotifyCallBack extends WxPayNotify { public function Queryorder($sp5ebe4f) { $sp5bf110 = new WxPayOrderQuery(); $sp5bf110->SetTransaction_id($sp5ebe4f); $sp820aff = WxPayApi::orderQuery($sp5bf110); \WxLog::DEBUG('query:' . json_encode($sp820aff)); if (array_key_exists('return_code', $sp820aff) && array_key_exists('result_code', $sp820aff) && $sp820aff['return_code'] == 'SUCCESS' && $sp820aff['result_code'] == 'SUCCESS') { return true; } return false; } public function NotifyProcess($sp69c4ce, &$sp3a6f3c) { \WxLog::DEBUG('call back:' . json_encode($sp69c4ce)); $spead10b = array(); if (!array_key_exists('transaction_id', $sp69c4ce)) { $sp3a6f3c = '输入参数不正确'; return false; } if (!$this->Queryorder($sp69c4ce['transaction_id'])) { $sp3a6f3c = '订单查询失败'; return false; } return true; } } \WxLog::DEBUG('begin notify'); $sp3f3238 = new PayNotifyCallBack(); $sp3f3238->Handle(false);