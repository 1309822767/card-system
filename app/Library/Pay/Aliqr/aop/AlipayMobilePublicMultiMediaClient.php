<?php
include 'AlipayMobilePublicMultiMediaExecute.php'; class AlipayMobilePublicMultiMediaClient { private $DEFAULT_CHARSET = 'UTF-8'; private $METHOD_POST = 'POST'; private $METHOD_GET = 'GET'; private $SIGN = 'sign'; private $timeout = 10; private $serverUrl; private $appId; private $privateKey; private $prodCode; private $format = 'json'; private $sign_type = 'RSA'; private $charset; private $apiVersion = '1.0'; private $apiMethodName = 'alipay.mobile.public.multimedia.download'; private $media_id = 'L21pZnMvVDFQV3hYWGJKWFhYYUNucHJYP3Q9YW13ZiZ4c2lnPTU0MzRhYjg1ZTZjNWJmZTMxZGJiNjIzNDdjMzFkNzkw575'; private $connectTimeout = 3000; private $readTimeout = 15000; function __construct($sp7d0a0e = '', $sp04b480 = '', $sp6138ca = '', $sp667761 = '', $sp9046a3 = 'GBK') { $this->serverUrl = $sp7d0a0e; $this->appId = $sp04b480; $this->privateKey = $sp6138ca; $this->format = $sp667761; $this->charset = $sp9046a3; } public function getContents() { $sp38bf00 = array('app_id' => $this->appId, 'method' => $this->METHOD_POST, 'sign_type' => $this->sign_type, 'version' => $this->apiVersion, 'timestamp' => date('Y-m-d H:i:s'), 'biz_content' => '{"mediaId":"' . $this->media_id . '"}', 'charset' => $this->charset); $spbafd73 = $this->buildGetUrl($sp38bf00); $sp94fccb = $spbafd73; $spd7a82f = curl_init(); curl_setopt($spd7a82f, CURLOPT_URL, $this->serverUrl); curl_setopt($spd7a82f, CURLOPT_HEADER, TRUE); curl_setopt($spd7a82f, CURLOPT_RETURNTRANSFER, 1); curl_setopt($spd7a82f, CURLOPT_TIMEOUT, $this->timeout); if ($this->METHOD_POST == 'POST') { curl_setopt($spd7a82f, CURLOPT_POST, 1); curl_setopt($spd7a82f, CURLOPT_POSTFIELDS, $sp94fccb); } $sp975c2a = curl_exec($spd7a82f); $spb47e7f = curl_getinfo($spd7a82f, CURLINFO_HTTP_CODE); curl_close($spd7a82f); echo $sp975c2a; $sp38bf00 = explode('

', $sp975c2a, 2); $sp1cc2d0 = $sp38bf00[0]; if ($spb47e7f == '200') { $sp66faf9 = $sp38bf00[1]; } else { $sp66faf9 = ''; } return $this->execute($sp1cc2d0, $sp66faf9, $spb47e7f); } public function execute($sp1cc2d0 = '', $sp66faf9 = '', $spb47e7f = '') { $sp198cc3 = new AlipayMobilePublicMultiMediaExecute($sp1cc2d0, $sp66faf9, $spb47e7f); return $sp198cc3; } public function buildGetUrl($spe8afa9 = array()) { if (!is_array($spe8afa9)) { } $spbda5b4 = $this->buildQuery($spe8afa9); $sp08afb6 = ''; $sp74b886 = 64; $sp2cb7de = $this->privateKey; $sp6cfdbd = array(); if (!stripos($sp2cb7de, '
')) { $sp218d20 = 0; while ($spd6060a = substr($sp2cb7de, $sp218d20 * $sp74b886, $sp74b886)) { $sp6cfdbd[] = $spd6060a; $sp218d20++; } } else { } $sp2cb7de = '-----BEGIN RSA PRIVATE KEY-----
' . implode('
', $sp6cfdbd); $sp2cb7de = $sp2cb7de . '
-----END RSA PRIVATE KEY-----'; $sp11d8ea = openssl_pkey_get_private($sp2cb7de, $sp08afb6); $spa9d06c = ''; if ('RSA2' == $this->sign_type) { openssl_sign($spbda5b4, $spa9d06c, $sp11d8ea, OPENSSL_ALGO_SHA256); } else { openssl_sign($spbda5b4, $spa9d06c, $sp11d8ea, OPENSSL_ALGO_SHA1); } openssl_free_key($sp11d8ea); $spa9d06c = base64_encode($spa9d06c); $spa9d06c = urlencode($spa9d06c); $spbc39dc = $spbda5b4 . '&' . $this->SIGN . '=' . $spa9d06c; return $spbc39dc; } public function buildQuery($spe8afa9) { if (!$spe8afa9) { return null; } ksort($spe8afa9); $sp342eea = array(); foreach ($spe8afa9 as $spc37b44 => $sp12919e) { $sp342eea[] = $spc37b44 . '=' . $sp12919e; } $spbda5b4 = implode('&', $sp342eea); return $spbda5b4; } }