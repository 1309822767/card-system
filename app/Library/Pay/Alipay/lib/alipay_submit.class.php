<?php
require_once 'alipay_core.function.php'; require_once 'alipay_md5.function.php'; class AlipaySubmit { var $alipay_config; var $alipay_gateway_new = 'https://mapi.alipay.com/gateway.do?'; function __construct($sp6e4d76) { $this->alipay_config = $sp6e4d76; } function AlipaySubmit($sp6e4d76) { $this->__construct($sp6e4d76); } function buildRequestMysign($sp49c400) { $sp804038 = createLinkString($sp49c400); switch (strtoupper(trim($this->alipay_config['sign_type']))) { case 'MD5': $spf841d0 = md5Sign($sp804038, $this->alipay_config['key']); break; default: $spf841d0 = ''; } return $spf841d0; } function buildRequestPara($sp95a7be) { $sp174189 = paraFilter($sp95a7be); $sp49c400 = argSort($sp174189); $spf841d0 = $this->buildRequestMysign($sp49c400); $sp49c400['sign'] = $spf841d0; $sp49c400['sign_type'] = strtoupper(trim($this->alipay_config['sign_type'])); return $sp49c400; } function buildRequestParaToString($sp95a7be) { $spaee562 = $this->buildRequestPara($sp95a7be); $spa30f55 = createLinkStringUrlEncode($spaee562); return $spa30f55; } function buildRequestForm($sp95a7be, $spb769a1, $sp851e60) { $spaee562 = $this->buildRequestPara($sp95a7be); $spdf4193 = '<form id=\'alipaysubmit\' name=\'alipaysubmit\' action=\'' . $this->alipay_gateway_new . '_input_charset=' . trim(strtolower($this->alipay_config['input_charset'])) . '\' method=\'' . $spb769a1 . '\'>'; foreach ($spaee562 as $spc37b44 => $spfca62c) { $spdf4193 .= '<input type=\'hidden\' name=\'' . $spc37b44 . '\' value=\'' . $spfca62c . '\'/>'; } $spdf4193 = $spdf4193 . '<input type=\'submit\'  value=\'' . $sp851e60 . '\' style=\'display:none;\'></form>'; $spdf4193 = $spdf4193 . '<script>document.forms[\'alipaysubmit\'].submit();</script>'; return $spdf4193; } function query_timestamp() { $sp81923e = $this->alipay_gateway_new . 'service=query_timestamp&partner=' . trim(strtolower($this->alipay_config['partner'])) . '&_input_charset=' . trim(strtolower($this->alipay_config['input_charset'])); $sp2f77bc = ''; $sp9a2040 = new DOMDocument(); $sp9a2040->load($sp81923e); $sp3cb31d = $sp9a2040->getElementsByTagName('encrypt_key'); $sp2f77bc = $sp3cb31d->item(0)->nodeValue; return $sp2f77bc; } }