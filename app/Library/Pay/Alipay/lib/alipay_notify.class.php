<?php
require_once 'alipay_core.function.php'; require_once 'alipay_md5.function.php'; class AlipayNotify { var $https_verify_url = 'https://mapi.alipay.com/gateway.do?service=notify_verify&'; var $http_verify_url = 'http://notify.alipay.com/trade/notify_query.do?'; var $alipay_config; function __construct($sp6e4d76) { $this->alipay_config = $sp6e4d76; } function AlipayNotify($sp6e4d76) { $this->__construct($sp6e4d76); } function verifyNotify() { if (empty($_POST)) { return false; } else { $sp4a6d31 = $this->getSignVeryfy($_POST, $_POST['sign']); $spfcc97d = 'false'; if (!empty($_POST['notify_id'])) { $spfcc97d = $this->getResponse($_POST['notify_id']); } if (preg_match('/true$/i', $spfcc97d) && $sp4a6d31) { return true; } else { return false; } } } function verifyReturn() { if (empty($_GET)) { return false; } else { $sp4a6d31 = $this->getSignVeryfy($_GET, $_GET['sign']); $spfcc97d = 'false'; if (!empty($_GET['notify_id'])) { $spfcc97d = $this->getResponse($_GET['notify_id']); } if (preg_match('/true$/i', $spfcc97d) && $sp4a6d31) { return true; } else { return false; } } } function getSignVeryfy($sp95a7be, $spa0f4ca) { $sp174189 = paraFilter($sp95a7be); $sp49c400 = argSort($sp174189); $sp804038 = createLinkString($sp49c400); $spb9813a = false; switch (strtoupper(trim($this->alipay_config['sign_type']))) { case 'MD5': $spb9813a = md5Verify($sp804038, $spa0f4ca, $this->alipay_config['key']); break; default: $spb9813a = false; } return $spb9813a; } function getResponse($sp84fce3) { $sp135344 = strtolower(trim($this->alipay_config['transport'])); $sp8ba851 = trim($this->alipay_config['partner']); $spc933f7 = ''; if ($sp135344 == 'https') { $spc933f7 = $this->https_verify_url; } else { $spc933f7 = $this->http_verify_url; } $spc933f7 = $spc933f7 . 'partner=' . $sp8ba851 . '&notify_id=' . $sp84fce3; $spfcc97d = getHttpResponseGET($spc933f7, $this->alipay_config['cacert']); return $spfcc97d; } }