<?php
require_once 'alipay_core.function.php'; class AlipayNotify { var $https_verify_url = 'https://mapi.alipay.com/gateway.do?service=notify_verify&'; var $http_verify_url = 'http://notify.alipay.com/trade/notify_query.do?'; var $alipay_config; function __construct($sp2db4f5) { $this->alipay_config = $sp2db4f5; } function AlipayNotify($sp2db4f5) { $this->__construct($sp2db4f5); } function verifyNotify() { if (empty($_POST)) { return false; } else { $sp21db24 = $this->getSignVeryfy($_POST, $_POST['sign']); $sp2adffd = 'false'; if (!empty($_POST['notify_id'])) { $sp2adffd = $this->getResponse($_POST['notify_id']); } if (preg_match('/true$/i', $sp2adffd) && $sp21db24) { return true; } else { return false; } } } function verifyReturn() { if (empty($_GET)) { return false; } else { $sp21db24 = $this->getSignVeryfy($_GET, $_GET['sign']); $sp2adffd = 'false'; if (!empty($_GET['notify_id'])) { $sp2adffd = $this->getResponse($_GET['notify_id']); } if (preg_match('/true$/i', $sp2adffd) && $sp21db24) { return true; } else { return false; } } } function getSignVeryfy($spd86662, $sp1e1df1) { $sp60c4f8 = paraFilter($spd86662); $spe596a5 = argSort($sp60c4f8); $sp350c49 = createLinkString($spe596a5); switch (strtoupper(trim($this->alipay_config['sign_type']))) { case 'MD5': $spa3e4d5 = md5Verify($sp350c49, $sp1e1df1, $this->alipay_config['key']); break; default: $spa3e4d5 = false; } return $spa3e4d5; } function getResponse($spcd9a86) { $sp02125e = strtolower(trim($this->alipay_config['transport'])); $spe0290f = trim($this->alipay_config['partner']); if ($sp02125e == 'https') { $spe659e8 = $this->https_verify_url; } else { $spe659e8 = $this->http_verify_url; } $spe659e8 = $spe659e8 . 'partner=' . $spe0290f . '&notify_id=' . $spcd9a86; $sp2adffd = getHttpResponseGET($spe659e8, $this->alipay_config['cacert']); return $sp2adffd; } }