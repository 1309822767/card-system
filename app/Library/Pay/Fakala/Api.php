<?php
namespace App\Library\Pay\Fakala; use App\Library\Pay\ApiInterface; class Api implements ApiInterface { private $url_notify = ''; private $url_return = ''; private $pay_id; public function __construct($spcbbf66) { $this->url_notify = SYS_URL_API . '/pay/notify/' . $spcbbf66; $this->url_return = SYS_URL . '/pay/return/' . $spcbbf66; $this->pay_id = $spcbbf66; } function goPay($spc6bf93, $sp30c318, $spc3fe8b, $sp66faf9, $spb959ec) { if (!isset($spc6bf93['gateway'])) { throw new \Exception('请填写gateway'); } if (!isset($spc6bf93['api_id'])) { throw new \Exception('请填写api_id'); } if (!isset($spc6bf93['api_key'])) { throw new \Exception('请填写api_key'); } include_once 'sdk.php'; $sp3a9be3 = new \fakala($spc6bf93['gateway'], $spc6bf93['api_id'], $spc6bf93['api_key']); $sp0a27da = strtolower($spc6bf93['payway']); $sp3a9be3->goPay($sp0a27da, $sp30c318, 0, $spb959ec, '', $this->url_return, $this->url_notify); } function verify($spc6bf93, $spc5d9aa) { $sp4dcba6 = isset($spc6bf93['isNotify']) && $spc6bf93['isNotify']; include_once 'sdk.php'; $sp3a9be3 = new \fakala($spc6bf93['gateway'], $spc6bf93['api_id'], $spc6bf93['api_key']); if ($sp4dcba6) { $spe62cd8 = $sp3a9be3->notify_verify(); } else { $spe62cd8 = $sp3a9be3->return_verify(); } if ($spe62cd8) { $sp30c318 = $_REQUEST['out_trade_no']; $sp51db0b = $_REQUEST['total_fee']; $sp89304f = $_REQUEST['order_no']; $spc5d9aa($sp30c318, $sp51db0b, $sp89304f); } return $spe62cd8; } }