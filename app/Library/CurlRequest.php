<?php
namespace App\Library; class CurlRequest { private static function curl($sp81923e, $spb769a1 = 0, $sp94fccb = '', &$sp6df092 = '', $sp79f0c2 = array(), $sped125a = 5) { if (!isset($sp79f0c2['Accept'])) { $sp79f0c2['Accept'] = '*/*'; } if (!isset($sp79f0c2['Referer'])) { $sp79f0c2['Referer'] = $sp81923e; } if (!isset($sp79f0c2['Content-Type'])) { $sp79f0c2['Content-Type'] = 'application/x-www-form-urlencoded'; } if (!isset($sp79f0c2['User-Agent'])) { $sp79f0c2['User-Agent'] = 'Mozilla/5.0 (Windows NT 10.0; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/55.0.2883.87 Safari/537.36'; } if ($sp6df092 != '') { $sp79f0c2['Cookie'] = $sp6df092; } $sp6ba962 = array(); foreach ($sp79f0c2 as $sp9b0cf3 => $sp645d2e) { $sp6ba962[] = $sp9b0cf3 . ': ' . $sp645d2e; } $sp6ba962[] = 'Expect:'; $spd7a82f = curl_init(); curl_setopt($spd7a82f, CURLOPT_URL, $sp81923e); if ($spb769a1 == 1) { curl_setopt($spd7a82f, CURLOPT_POST, 1); if ($sp94fccb != '') { curl_setopt($spd7a82f, CURLOPT_POSTFIELDS, $sp94fccb); } } if (defined('MY_PROXY')) { curl_setopt($spd7a82f, CURLOPT_PROXY, MY_PROXY); } if (defined('MY_PROXY_PASS')) { curl_setopt($spd7a82f, CURLOPT_PROXYUSERPWD, MY_PROXY_PASS); } curl_setopt($spd7a82f, CURLOPT_TIMEOUT, $sped125a); curl_setopt($spd7a82f, CURLOPT_CONNECTTIMEOUT, $sped125a); curl_setopt($spd7a82f, CURLOPT_RETURNTRANSFER, 1); curl_setopt($spd7a82f, CURLOPT_HEADER, 1); curl_setopt($spd7a82f, CURLOPT_HTTPHEADER, $sp6ba962); $spd6e0e5 = curl_exec($spd7a82f); $sp9ca9e1 = curl_getinfo($spd7a82f, CURLINFO_HEADER_SIZE); $sp1cc2d0 = substr($spd6e0e5, 0, $sp9ca9e1); $sp66faf9 = substr($spd6e0e5, $sp9ca9e1); curl_close($spd7a82f); $sp79f0c2 = explode('
', $sp1cc2d0); $sp595f71 = ''; foreach ($sp79f0c2 as $sp1cc2d0) { if (strpos($sp1cc2d0, 'Set-Cookie') !== false) { if (strpos($sp1cc2d0, ';') !== false) { $sp595f71 = $sp595f71 . trim(Helper::strBetween($sp1cc2d0, 'Set-Cookie:', ';')) . ';'; } else { $sp595f71 = $sp595f71 . trim(str_replace('Set-Cookie:', '', $sp1cc2d0)) . ';'; } } } $sp6df092 = self::combineCookie($sp6df092, $sp595f71); return $sp66faf9; } public static function get($sp81923e, &$sp6df092 = '', $sp79f0c2 = array(), $sped125a = 5) { return self::curl($sp81923e, 0, '', $sp6df092, $sp79f0c2, $sped125a); } public static function post($sp81923e, $sp94fccb = '', &$sp6df092 = '', $sp79f0c2 = array(), $sped125a = 5) { return self::curl($sp81923e, 1, $sp94fccb, $sp6df092, $sp79f0c2, $sped125a); } public static function combineCookie($sp20a6e5, $spb62c5b) { $sp2ecf5b = explode(';', $sp20a6e5); $sp71b561 = explode(';', $spb62c5b); foreach ($sp2ecf5b as $sp91490f) { if (self::cookieIsExists($sp71b561, self::cookieGetName($sp91490f)) == false) { array_push($sp71b561, $sp91490f); } } $sp5ac83f = ''; foreach ($sp71b561 as $sp91490f) { if (substr($sp91490f, -8, 8) != '=deleted' && strlen($sp91490f) > 1) { $sp5ac83f .= $sp91490f . '; '; } } return substr($sp5ac83f, 0, strlen($sp5ac83f) - 2); } public static function cookieGetName($spbc2299) { $spfe5663 = strpos($spbc2299, '='); return substr($spbc2299, 0, $spfe5663); } public static function cookieGetValue($spbc2299) { $spfe5663 = strpos($spbc2299, '='); $spe8bdca = substr($spbc2299, $spfe5663 + 1, strlen($spbc2299) - $spfe5663); return $spe8bdca; } public static function cookieGet($sp6df092, $sp5cab35, $sp52fc06 = false) { $sp6df092 = str_replace(' ', '', $sp6df092); if (substr($sp6df092, -1, 1) != ';') { $sp6df092 = ';' . $sp6df092 . ';'; } else { $sp6df092 = ';' . $sp6df092; } $sp7ea471 = Helper::strBetween($sp6df092, ';' . $sp5cab35 . '=', ';'); if (!$sp52fc06 || $sp7ea471 == '') { return $sp7ea471; } else { return $sp5cab35 . '=' . $sp7ea471; } } private static function cookieIsExists($spb061df, $spfccb8e) { foreach ($spb061df as $sp91490f) { if (self::cookieGetName($sp91490f) == $spfccb8e) { return true; } } return false; } function test() { $spe8bdca = self::combineCookie('a=1;b=2;c=3', 'c=5'); var_dump($spe8bdca); } }