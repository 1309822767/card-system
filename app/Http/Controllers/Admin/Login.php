<?php
namespace App\Http\Controllers\Admin; use App\Library\Helper; use Auth; use Illuminate\Http\Request; use App\Http\Controllers\Controller; use App\Library\Response; use Illuminate\Support\Facades\Hash; class Login extends Controller { public function login(Request $spf631e6) { $spbf5aff = $spf631e6->input('remember') == 'true'; if (!Auth::attempt(array('email' => $spf631e6->input('email'), 'password' => $spf631e6->input('password')), $spbf5aff) || Auth::getUser()->role !== 'admin') { return Response::fail('邮箱或密码错误, 请检查'); } else { $sp63838a = new \App\Log(); $sp63838a->user_id = Auth::Id(); $sp63838a->ip = Helper::getIP(); $sp63838a->action = \App\Log::ACTION_LOGIN; $sp63838a->save(); $sp5b5487 = Auth::getUser(); $sp5b5487->addHidden(array('created_at', 'updated_at')); return Response::success(array('token' => 'login', 'user' => $sp5b5487->toArray())); } } function info() { $sp5b5487 = Auth::getUser(); $sp5b5487->addHidden(array('created_at', 'updated_at')); return Response::success(array('token' => 'login', 'user' => $sp5b5487->toArray())); } function logout(Request $spf631e6) { Auth::logout(); return Response::success(); } function changePassword(Request $spf631e6) { $sp5b5487 = Auth::getUser(); $sp20a6e5 = $spf631e6->post('old', null); $spc5d82e = $spf631e6->post('password', null); if (strlen($spc5d82e) < 6 || strlen($spc5d82e) > 32) { return Response::fail('请输入6-32位密码'); } if (!Hash::check($sp20a6e5, $sp5b5487->password)) { return Response::fail('旧密码错误，请检查'); } $sp5b5487->password = bcrypt($spc5d82e); $sp5b5487->saveOrFail(); return Response::success(); } }