<?php
namespace App\Console; use App\System; use Carbon\Carbon; use Illuminate\Console\Scheduling\Schedule; use Illuminate\Foundation\Console\Kernel as ConsoleKernel; use Illuminate\Support\Facades\DB; use Illuminate\Support\Facades\Log; use Illuminate\Support\Facades\Schema; class Kernel extends ConsoleKernel { protected $commands = array(); protected function schedule(Schedule $sp4a8527) { if (!app()->runningInConsole()) { return; } try { DB::connection()->getPdo(); if (Schema::hasTable('migrations')) { if (!Schema::hasTable('systems')) { die(' * No system table, please install your website first.
'); } } else { return; } } catch (\Exception $spbcc446) { if (config('database.connections.mysql.host') === '数据库地址') { die(' * Please change your config of database in \'.env\' file 
'); } else { die(' * Database connection error: ' . $spbcc446->getMessage() . '
'); } } if (System::_getInt('order_clean_unpay_open') === 1) { $sp73a9ec = System::_getInt('order_clean_unpay_day', 7); $sp4a8527->call(function () use($sp73a9ec) { echo '[' . date('Y-m-d H:i:s') . "] cleaning unpaid orders({${$sp73a9ec}}days ago)...\n"; \App\Order::where('status', \App\Order::STATUS_UNPAY)->where('created_at', '<', (new Carbon())->addDays(-$sp73a9ec))->delete(); $sp45c66f = '[' . date('Y-m-d H:i:s') . '] unpaid-orders cleaned 
'; echo $sp45c66f; })->dailyAt('01:00'); } $sp4a8527->call(function () { $sp73a9ec = 7; echo '[' . date('Y-m-d H:i:s') . "] cleaning deleted cards({${$sp73a9ec}}days ago)...\n"; \App\Card::onlyTrashed()->where('deleted_at', '<', (new Carbon())->addDays(-$sp73a9ec))->forceDelete(); $sp45c66f = '[' . date('Y-m-d H:i:s') . '] deleted-cards cleaned
'; echo $sp45c66f; })->dailyAt('02:00'); } protected function commands() { $this->load(__DIR__ . '/Commands'); require base_path('routes/console.php'); } }